<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Wonfee&#39;s HomePage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Wonfee's HomePage">
<meta property="og:url" content="http://wonfee.github.io/index.html">
<meta property="og:site_name" content="Wonfee's HomePage">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wonfee's HomePage">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Wonfee&#39;s HomePage" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Wonfee&#39;s HomePage</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">body and soul, there must be one on the road.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://wonfee.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-add-system-call-to-linux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/15/add-system-call-to-linux/" class="article-date">
  <time datetime="2015-11-15T10:42:22.000Z" itemprop="datePublished">2015-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/15/add-system-call-to-linux/">add system call to linux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>添加系统系统到内核，测试环境huawei u9508手机，基于内核代码<a href="git@github.com:Wonfee/huawei_u9508_kernel.git">huawei u9508 kernel</a></p>
<ol>
<li><p>修改 arch/arm/kernel/calls.S</p>
<p> diff —git a/arch/arm/kernel/calls.S b/arch/arm/kernel/calls.S<br> index 80f7896..100320f 100644<br> —- a/arch/arm/kernel/calls.S<br> +++ b/arch/arm/kernel/calls.S<br> @@ -385,6 +385,7 @@</p>
<pre><code><span class="function"><span class="title">CALL</span><span class="params">(sys_syncfs)</span></span>
<span class="function"><span class="title">CALL</span><span class="params">(sys_sendmmsg)</span></span>
</code></pre><p>  /<em> 375 </em>/      CALL(sys_setns)</p>
<ul>
<li>CALL(sys_hello)<h1 id="ifndef_syscalls_counted">ifndef syscalls_counted</h1>.equ syscalls_padding, ((NR_syscalls + 3) &amp; ~3) - NR_syscalls<h1 id="define_syscalls_counted">define syscalls_counted</h1></li>
</ul>
</li>
<li><p>修改 include/linux/syscalls.h</p>
<p> diff —git a/include/linux/syscalls.h b/include/linux/syscalls.h<br> index 8c03b98..ca05033 100644<br> —- a/include/linux/syscalls.h<br> +++ b/include/linux/syscalls.h<br> @@ -847,4 +847,5 @@ asmlinkage long sys_open_by_handle_at(int mountdirfd,</p>
<pre><code><span class="keyword">struct</span> file_handle __user *<span class="keyword">handle</span>,
<span class="built_in">int</span> flags);
</code></pre><p>  asmlinkage long sys_setns(int fd, int nstype);<br> +asmlinkage long sys_hello(void);</p>
<h1 id="endif">endif</h1></li>
<li><p>修改 arch/arm/include/asm/unistd.h</p>
<p> diff —git a/arch/arm/include/asm/unistd.h b/arch/arm/include/asm/unistd.h<br> index 2c04ed5..fa6cc69 100644<br> —- a/arch/arm/include/asm/unistd.h<br> +++ b/arch/arm/include/asm/unistd.h<br> @@ -402,6 +402,7 @@</p>
<h1 id="define_NR_syncfs_(NR_SYSCALL_BASE+373)">define <strong>NR_syncfs                    (</strong>NR_SYSCALL_BASE+373)</h1><h1 id="define_NR_sendmmsg_(NR_SYSCALL_BASE+374)">define <strong>NR_sendmmsg                  (</strong>NR_SYSCALL_BASE+374)</h1><h1 id="define_NR_setns_(NR_SYSCALL_BASE+375)">define <strong>NR_setns                     (</strong>NR_SYSCALL_BASE+375)</h1><p> +#define <strong>NR_sys_hello                 (</strong>NR_SYSCALL_BASE+376)</p>
<p>  /*</p>
<ul>
<li>The following SWIs are ARM private.</li>
</ul>
</li>
<li><p>在kernel下添加hello目录，并添加hello.c, Makefile</p>
<p> hello/<br> ├── hello.c<br> └── Makefile</p>
</li>
</ol>
<p>vim hello.c</p>
<pre><code><span class="preprocessor">#<span class="keyword">include</span> &lt;linux/kernel.h&gt;</span>
<span class="function">asmlinkage <span class="keyword">long</span> <span class="title">sys_hello</span><span class="params">(<span class="keyword">void</span>)</span> 
</span>{
    printk(<span class="string">"hello world\n"</span>);
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre><p>vim Makefile</p>
<pre><code><span class="rule"><span class="attribute">obj-y </span>:<span class="value">= hello.o</span></span>
</code></pre><ol>
<li><p>修改kernel下Makefile</p>
<p> diff —git a/Makefile b/Makefile<br> index 9651e1c..3e54a62 100755<br> —- a/Makefile<br> +++ b/Makefile<br> @@ -719,7 +719,7 @@ export mod_strip_cmd</p>
</li>
</ol>
<pre><code> ifeq (<span class="variable">$(</span>KBUILD_EXTMOD),)
-core-y         += kernel/ mm/ fs/ ipc/ security/ crypto/ block/
+core-y         += kernel/ mm/ fs/ ipc/ security/ crypto/ block/ hello/

 vmlinux-dirs   := <span class="variable">$(</span>patsubst <span class="variable">%/</span>,<span class="variable">%,</span><span class="variable">$(</span><span class="keyword">filter</span> <span class="variable">%/</span>, <span class="variable">$(</span>init-y) <span class="variable">$(</span>init-m) \
                     <span class="variable">$(</span>core-y) <span class="variable">$(</span>core-m) <span class="variable">$(</span>drivers-y) <span class="variable">$(</span>drivers-m) \
</code></pre><ol>
<li><p>编译内核</p>
<p> export CROSS_COMPILE=arm-linux-androideabi-<br> export ARCH=arm<br> make distclean<br> make hisi_k3v2oem1_defconfig<br> make zImage</p>
</li>
<li><p>modify boot.img with our build zImage<br> mkboot boot.img boot<br> ….<br> mkboot boot boot_new.img<br> adb reboot bootloader<br> fastboot flash boot boot_new.img<br> fastboot reboot</p>
</li>
<li><p>测试添加的系统调用</p>
<p> jni/<br> ├── Android.mk<br> └── sys_hello.cpp</p>
</li>
</ol>
<p>vim sys_hello.cpp</p>
<pre><code><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;linux/kernel.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;sys/syscall.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;unistd.h&gt;</span>

<span class="preprocessor">#<span class="keyword">define</span> __NR_hello 376</span>

<span class="function"><span class="keyword">long</span> <span class="title">hello_syscall</span><span class="params">(<span class="keyword">void</span>)</span>
</span>{
    <span class="keyword">return</span> syscall(__NR_hello);
}

<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span>
</span>{
    <span class="keyword">long</span> <span class="keyword">int</span> a = hello_syscall();
    <span class="built_in">printf</span>(<span class="string">"System call returned %ld\n"</span>, a);
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre><p>vim Android.mk</p>
<pre><code><span class="constant">LOCAL_PATH </span><span class="symbol">:</span>= <span class="variable">$(</span>call my-dir)

<span class="keyword">include</span> <span class="variable">$(</span><span class="constant">CLEAR_VARS)</span>

<span class="constant">LOCAL_SRC_FILES </span>+= sys_hello.cpp

<span class="constant">LOCAL_MODULE </span><span class="symbol">:</span>= hello
<span class="keyword">include</span> <span class="variable">$(</span><span class="constant">BUILD_EXECUTABLE)</span>
</code></pre><p>ndk-build</p>
<pre><code><span class="string">StaticLibrary  :</span> libstdc++.a
<span class="string">Executable     :</span> hello
<span class="string">Install        :</span> hello =&gt; libs<span class="regexp">/armeabi/</span>hello
</code></pre><p>adb push libs/armeabi/hello /data/local/tmp/<br>adb shell</p>
<pre><code>root<span class="variable">@android</span><span class="symbol">:/data/local/tmp</span> <span class="comment"># ./hello                                         </span>
<span class="constant">System </span>call returned <span class="number">0</span>
root<span class="variable">@android</span><span class="symbol">:/data/local/tmp</span> <span class="comment"># dmesg                                           </span>
&lt;<span class="number">4</span>&gt;[<span class="number">5494.1</span>, hello] [ <span class="number">1911.446306</span>] hello world
</code></pre><p>以上针对arm平台添加的系统调用，若为x86平台，则需要将1,2,3步修改为x86目录下相应的文件即可;<br>参考： <a href="http://techeclipse.com/how-to/linux-kernel/" target="_blank" rel="external">How To Add A System Call and Recompile the Linux Kernel</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/11/15/add-system-call-to-linux/" data-id="cih0e9awb000v3xhj3vl0ndcp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/syscall/">syscall</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-compile-binary-fow-windows-on-linux-with-mingw" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/12/compile-binary-fow-windows-on-linux-with-mingw/" class="article-date">
  <time datetime="2015-11-12T02:17:18.000Z" itemprop="datePublished">2015-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/12/compile-binary-fow-windows-on-linux-with-mingw/">compile binary fow windows on linux with mingw</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="with_mingw_we_can_compile_3rd_party_project_for_windows_on_linux-">with mingw we can compile 3rd party project for windows on linux.</h2><p>compile openssl for example:<br>参考： <a href="http://www.blogcompiler.com/2011/12/21/openssl-for-windows/" target="_blank" rel="external">OpenSSL for Windows</a></p>
<ol>
<li><p>setup cross compile environment.<br> sudo apt-get install mingw-w64 binutils-mingw-w64</p>
</li>
<li><p>download openssl source code<br> git clone <a href="https://github.com/openssl/openssl.git" target="_blank" rel="external">https://github.com/openssl/openssl.git</a></p>
</li>
<li><p>cross compile with mingw<br> cd openssl<br> ./Configure —cross-compile-prefix=i686-w64-mingw32- mingw64 no-asm shared —prefix=xxx<br> make<br> make install</p>
<p> ├── bin<br> │   ├── c_rehash<br> │   ├── libeay32.dll<br> │   ├── openssl.exe<br> │   └── ssleay32.dll<br> ├── include<br> │   └── openssl<br> ├── lib<br> │   ├── engines<br> │   ├── libcrypto.a<br> │   ├── libcrypto.dll.a<br> │   ├── libssl.a<br> │   ├── libssl.dll.a<br> │   └── pkgconfig<br> └── ssl</p>
<pre><code>├── certs
├── <span class="keyword">man</span>
├── misc
├── openssl.cnf
└── private
</code></pre></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/11/12/compile-binary-fow-windows-on-linux-with-mingw/" data-id="cih0e9aw4000j3xhj0t820lrm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mingw-cross-compile/">mingw cross-compile</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-add-libusb-win32-to-vc-project" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/03/add-libusb-win32-to-vc-project/" class="article-date">
  <time datetime="2015-11-03T08:32:58.000Z" itemprop="datePublished">2015-11-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/03/add-libusb-win32-to-vc-project/">add libusb-win32 to vc project</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="windows下面使用libusb开源库">windows下面使用libusb开源库</h2><p>下载已经编译好的libusb <a href="http://libusb-win32.sourceforge.net" target="_blank" rel="external">libusb-win32-bin-1.2.6.0</a></p>
<p>目录结构：</p>
<pre><code>libusb-win32-bin-<span class="number">1.2</span>.<span class="number">6.0</span>
├── AUTHORS<span class="class">.txt</span>
├── bin
│   ├── amd64
│   ├── ia64
│   ├── inf-wizard<span class="class">.exe</span>
│   ├── libusb-win32-bin-README<span class="class">.txt</span>
│   └── x86
├── COPYING_GPL<span class="class">.txt</span>
├── COPYING_LGPL<span class="class">.txt</span>
├── examples
│   ├── benchmark<span class="class">.c</span>
│   ├── BenchmarkHelp<span class="class">.txt</span>
│   ├── benchmark_rc<span class="class">.rc</span>
│   ├── bulk<span class="class">.c</span>
│   ├── driver_installer_template<span class="class">.iss</span>
│   └── testbulk_rc<span class="class">.rc</span>
├── include
│   └── lusb0_usb<span class="class">.h</span>
├── installer_license<span class="class">.txt</span>
├── lib
│   ├── bcc
│   ├── dynamic
│   ├── gcc
│   ├── msvc
│   ├── msvc_i64
│   └── msvc_x64
├── libusb-win32-changelog-<span class="number">1.2</span>.<span class="number">6.0</span><span class="class">.txt</span>
└── README.txt
</code></pre><p>根据下面的步骤将库添加到vc工程中<br><a href="http://stackoverflow.com/questions/20058864/how-to-include-libraries-in-visual-studio-2012" target="_blank" rel="external">参考： stackoverflow</a></p>
<pre><code><span class="type">Typically</span> you need <span class="keyword">to</span> <span class="keyword">do</span> <span class="number">5</span> things <span class="keyword">to</span> <span class="keyword">include</span> a library <span class="keyword">in</span> your project:

<span class="number">1</span>) <span class="type">Add</span> #<span class="keyword">include</span> statements necessary files <span class="keyword">with</span> declarations/interfaces, e.g.:

#<span class="keyword">include</span> <span class="string">"library.h"</span>
<span class="number">2</span>) <span class="type">Add</span> an <span class="keyword">include</span> directory <span class="keyword">for</span> the compiler <span class="keyword">to</span> look into

-&gt; <span class="type">Configuration</span> <span class="type">Properties</span>/<span class="type">VC</span>++ <span class="type">Directories</span>/<span class="type">Include</span> <span class="type">Directories</span> (click <span class="keyword">and</span> edit, add a <span class="keyword">new</span> entry)

<span class="number">3</span>) <span class="type">Add</span> a library directory <span class="keyword">for</span> *.lib files:

-&gt; <span class="type">Configuration</span> <span class="type">Properties</span>/<span class="type">VC</span>++ <span class="type">Directories</span>/<span class="type">Library</span> <span class="type">Directories</span> (click <span class="keyword">and</span> edit, add a <span class="keyword">new</span> entry)

<span class="number">4</span>) <span class="type">Link</span> the lib's *.lib files

-&gt; <span class="type">Configuration</span> <span class="type">Properties</span>/<span class="type">Linker</span>/<span class="type">Input</span>/<span class="type">Additional</span> <span class="type">Dependencies</span> (e.g.: library.lib;

<span class="number">5</span>) <span class="type">Place</span> *.dll files either:

-&gt; <span class="keyword">in</span> the directory you'll be opening your final executable from <span class="keyword">or</span> into <span class="type">Windows</span>/system32
</code></pre><p>编写测试代码：<br>参考 examples/bulk.c</p>
<pre><code><span class="preprocessor">#<span class="keyword">include</span> "stdafx.h"</span>
<span class="preprocessor">#<span class="keyword">include</span> "lusb0_usb.h"</span>

<span class="preprocessor">#<span class="keyword">define</span> MY_VID 0x0421</span>
<span class="preprocessor">#<span class="keyword">define</span> MY_PID 0x03C5</span>

<span class="comment">////////////////////////////////////////////////////</span>
usb_dev_handle *open_dev(<span class="keyword">void</span>)
{
    <span class="keyword">struct</span> usb_bus *bus;
    <span class="keyword">struct</span> usb_device *dev;

    <span class="keyword">for</span> (bus = usb_get_busses(); bus; bus = bus-&gt;next)
    {
        <span class="keyword">for</span> (dev = bus-&gt;devices; dev; dev = dev-&gt;next)
        {
            <span class="keyword">if</span> (dev-&gt;descriptor.idVendor == MY_VID
                &amp;&amp; dev-&gt;descriptor.idProduct == MY_PID)
            {
                <span class="keyword">return</span> usb_open(dev);
            }
        }
    }
    <span class="keyword">return</span> NULL;
}

<span class="keyword">int</span> <span class="keyword">_t</span>main(<span class="keyword">int</span> argc, _TCHAR* argv[])
{
        usb_dev_handle *dev = NULL; 
        usb_init(); 
        usb_find_busses(); 
        usb_find_devices(); 

        <span class="keyword">if</span> (!(dev = open_dev()))
        {
            <span class="built_in">printf</span>(<span class="string">"error opening device: \n%s\n"</span>, usb_strerror());
            <span class="keyword">return</span> <span class="number">0</span>;
        }
        <span class="keyword">else</span>
        {
            <span class="built_in">printf</span>(<span class="string">"success: device %04X:%04X opened\n"</span>, MY_VID, MY_PID);
        }
    <span class="keyword">return</span> <span class="number">0</span>;
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/11/03/add-libusb-win32-to-vc-project/" data-id="cih0e9awd000y3xhjyvxhpr26" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/libusb-win32/">libusb-win32</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-huawei-k3v2oem1-kernel-compile" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/19/huawei-k3v2oem1-kernel-compile/" class="article-date">
  <time datetime="2015-10-19T00:23:51.000Z" itemprop="datePublished">2015-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/19/huawei-k3v2oem1-kernel-compile/">huawei k3v2oem1 kernel compile</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="compile_huawei_k3v2oem1_kernel">compile huawei k3v2oem1 kernel</h2><h3 id="get_source_code_:">get source code :</h3><p><a href="https://github.com/mangusta86/android_kernel_huawei_k3v2oem1.git" target="_blank" rel="external">android_kernel_huawei_k3v2oem1</a></p>
<h3 id="pre-compile">pre-compile</h3><p>which device can use it ?<br> README_Version.txt</p>
<pre><code>Kernel <span class="keyword">release</span> <span class="keyword">package</span> version instruction

<span class="keyword">USE</span> zImage NOTE:

<span class="number">1</span>¡¢This <span class="keyword">package</span> make <span class="keyword">out</span> zImage only, you have <span class="keyword">to</span> get ramdisk <span class="keyword">and</span> add kernel cmdline <span class="keyword">to</span> <span class="keyword">generate</span> a total boot.img before replace your phone<span class="attribute">'s</span> bootimage.
<span class="number">2</span>¡¢<span class="keyword">If</span> your phone already enable secboot feature, please decrypt <span class="keyword">or</span> unlock the secboot feature first.
<span class="number">3</span>¡¢Please make sure your phone software version <span class="keyword">is</span> same <span class="keyword">with</span> this <span class="keyword">release</span> <span class="keyword">package</span>, <span class="keyword">if</span> <span class="keyword">not</span>, please download the match version first.

This kernel <span class="keyword">package</span> <span class="keyword">is</span> released <span class="keyword">for</span> the phone software version U9508 V100R001CHNC00B550
</code></pre><p>how to compile it?<br>README_Kernel.txt</p>
<pre><code><span class="comment">################################################################################</span>

<span class="number">1</span>. <span class="constant">How</span> to <span class="constant">Build</span>
    - get <span class="constant">Toolchain</span>
        <span class="constant">From</span> android git server , codesourcery <span class="keyword">and</span> etc ..
         - arm-linux-androideabi-<span class="number">4.6</span>

    - edit <span class="constant">Makefile</span>
        edit <span class="string">"CROSS_COMPILE"</span> to right toolchain path(<span class="constant">You</span> downloaded).
          <span class="constant">EX</span>)   <span class="constant">CROSS_COMPILE</span>= <span class="variable">$(</span>android platform directory you download)/android/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-<span class="number">4.6</span>/bin/arm-linux-androideabi-
          <span class="constant">Ex</span>)   <span class="constant">CROSS_COMPILE</span>=<span class="regexp">/usr/local</span><span class="regexp">/toolchain/arm</span>-linux-androideabi-<span class="number">4.6</span>/bin/arm-linux-androideabi-          <span class="regexp">//</span> check the location of toolchain
          <span class="keyword">or</span>
          <span class="constant">Ex</span>)<span class="constant">Exexport</span> <span class="constant">CROSS_COMPILE</span>=arm-linux-androideabi-
          <span class="constant">Ex</span>)<span class="constant">Exexport</span> <span class="constant">PATH</span>=<span class="variable">$PATH</span><span class="symbol">:&lt;toolchain_parent_dir&gt;/arm-linux-androideabi-</span><span class="number">4.6</span>/bin

        <span class="variable">$ </span>make <span class="constant">ARCH</span>=arm hisi_k3v2oem1_defconfig
        <span class="variable">$ </span>make <span class="constant">ARCH</span>=arm zImage

<span class="number">2</span>. <span class="constant">Output</span> files
    - <span class="constant">Kernel</span> <span class="symbol">:</span> arch/arm/boot/zImage
    - <span class="class"><span class="keyword">module</span> : <span class="title">drivers</span>/*/*.<span class="title">ko</span></span>

<span class="number">3</span>. <span class="constant">How</span> to <span class="constant">Clean</span>
        <span class="variable">$ </span>make <span class="constant">ARCH</span>=arm distclean
<span class="comment">################################################################################</span>
</code></pre><h3 id="compile">compile</h3><p>error fix:</p>
<p><1> perl parse excel fail.<br>arch/arm/mach-k3v2/ipps_para_gen.pl line 3 error</1></p>
<pre><code>make sure your have perl installed with perl -v
<span class="operator"><span class="keyword">install</span> perl excel <span class="keyword">parse</span> library
sudo cpan
    <span class="keyword">install</span> OLE::Storage_Lite
    <span class="keyword">install</span> Spreadsheet::ParseExcel</span>
</code></pre><p><2> lzop not found.<br>OBJCOPY arch/arm/boot/Image<br>Kernel: arch/arm/boot/Image is ready<br>AS      arch/arm/boot/compressed/head.o<br>LZO     arch/arm/boot/compressed/piggy.lzo<br>/bin/sh: 1: lzop: not found<br>make[2]: <strong><em> [arch/arm/boot/compressed/piggy.lzo] Error 1<br>make<a href="https://github.com/mangusta86/android_kernel_huawei_k3v2oem1.git" target="_blank" rel="external">1</a>: </em></strong> [arch/arm/boot/compressed/vmlinux] Error 2<br>make: <em>*</em> [zImage] Error 2</2></p>
<pre><code>sudo apt-<span class="keyword">get</span> install lzop
</code></pre><h3 id="Test">Test</h3><p>repack boot.img , then flash it with fastboot, please make sure you had unlocked your phone.<br>huawei u9508 with this to unlock</p>
<pre><code><span class="title">fastboot</span> oem unlock UUUUUUUUUUUUUUUU
</code></pre><p>repack boot.img</p>
<pre><code>mkboot <span class="keyword">boot</span>.img <span class="keyword">out</span>
... <span class="keyword">replace</span> <span class="keyword">out</span>/zImage
mkboot <span class="keyword">out</span> new_boot.img
</code></pre><p>flash</p>
<pre><code>adb reboot bootloader
fastboot flash boot new_boot<span class="class">.img</span>
or 
fastboot flash:raw boot zImage ramdisk<span class="class">.gz</span>
fastboot reboot
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/10/19/huawei-k3v2oem1-kernel-compile/" data-id="cih0e9avz000a3xhjef55l6wu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k3v2oem1-kernel/">k3v2oem1 kernel</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-android-reverse-tools" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/15/android-reverse-tools/" class="article-date">
  <time datetime="2015-10-15T09:56:01.000Z" itemprop="datePublished">2015-10-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/android-reverse-tools/">android reverse tools</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>tools are in my github<br>    git@github.com:Wonfee/android-reverse-tools.git</p>
<h2 id="apk_modify">apk modify</h2><p>a. apktool<br><a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="external">apktool官网</a><br>usage:<br>    apktool d xx.apk<br>    apktool b xx<br>b. baksmali/smali<br>    <a href="https://github.com/JesusFreke/smali" target="_blank" rel="external">baksmali github</a></p>
<h2 id="apk_resign">apk resign</h2><pre><code><span class="tag">signapk</span> <span class="tag">xx</span><span class="class">.apk</span>
</code></pre><h2 id="boot-img_recovery-img_unpack_repack">boot.img recovery.img unpack repack</h2><p>a. use android source code tools otatools</p>
<p>b. abootimg<br>    $ apt-cache search abootimg<br>    abootimg - Tool to read/write/update android boot images<br>    $ sudo apt-get install abootimg<br>    $ abootimg -i boot.img </p>
<p>c. mkboot<br>    <a href="https://github.com/xiaolu/mkbootimg_tools.git" target="_blank" rel="external">mkbootimg_tools github地址</a><br>    which fix dtb missing when use abootimg tool to unpack boot.img or recovery.img</p>
<h2 id="how_to_use">how to use</h2><p>just set environment then enjoy it …</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/10/15/android-reverse-tools/" data-id="cih0e9aw9000s3xhj0irbnci1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reverse-tools/">reverse tools</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-Log-on-as-Administrator-in-win8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/15/Log-on-as-Administrator-in-win8/" class="article-date">
  <time datetime="2015-10-15T07:57:45.000Z" itemprop="datePublished">2015-10-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/Log-on-as-Administrator-in-win8/">Log on as Administrator in win8</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一、我的电脑-&gt;管理-&gt;本地用户和组-&gt;Administrator</p>
<p>二、cmd prompt<br>    net user administrator /active:yes<br>    net user administrator /active:no</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/10/15/Log-on-as-Administrator-in-win8/" data-id="cih0e9awh00183xhj7vnxk3ma" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/win8-administrator/">win8 administrator</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-porting-cyanogenmod" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/09/29/porting-cyanogenmod/" class="article-date">
  <time datetime="2015-09-29T01:12:49.000Z" itemprop="datePublished">2015-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/29/porting-cyanogenmod/">porting cyanogenmod</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>由于Cyanogenmod的源码编译已经没有问题，手头手机又都不在Cyanogenmod的支持列表里，所以打算将cyanogenmod亲自移植到我自己的手机上。<br>参考：<a href="https://wiki.cyanogenmod.org/w/Doc:_porting_intro" target="_blank" rel="external">How To Port CyanogenMod Android To Your Own Device</a></p>
<h3 id="必备知识">必备知识</h3><p>成功移植过cyanogenmod到已知已支持的设备上;<br>对cyanogenmod的代码目录结构要熟悉;<br>移植一般会涉及到如下三个目录：<br>    /device/[vendor]/[codename]<br>    /vendor/[vendor]/[codename]<br>    /kernel/[vendor]/[codename]</p>
<h3 id="搜集我们手机的相关信息">搜集我们手机的相关信息</h3><p>搜集手机的必要信息，如：product name, code name, architecture, memory size, internal storage size, and platform architecture.可以从手机中读取（手机最好已经root），或者在网上下载.zip升级包，从.zip包里解出获取相关信息;</p>
<pre><code>mkdir <span class="keyword">le</span><span class="label">novo_s2</span> &amp;&amp; cd <span class="keyword">le</span><span class="label">novo_s2</span>
adb pull /system/build.prop
</code></pre><p> vendor name:<br> adb shell getprop ro.product.manufacturer 或者从build.prop中读取<br> codename：<br> adb shell getprop ro.product.device 或者从build.prop中读取</p>
<h3 id="解包boot-img_或者_recovery-img得到内核文件kernel，在得不到内核源码的情况下，可以通过这种方式得到编译好的内核文件;">解包boot.img 或者 recovery.img得到内核文件kernel，在得不到内核源码的情况下，可以通过这种方式得到编译好的内核文件;</h3><p>boot.img,recovery.img可以在root过的手机上找到其对应分区，然后取出来;或者从.zip中得到;</p>
<h3 id="在device、vendor、kernel下创建手机相关的目录">在device、vendor、kernel下创建手机相关的目录</h3><ol>
<li>通过mkvendor.sh脚本自动创建</li>
<li>从github仓库里找是否有手机型号比较接近的然后克隆下来</li>
<li>手动创建这三个目录结构</li>
</ol>
<p>我们使用1.的方式，此种方式比较快速，先得到boot.img或者recovery.img</p>
<pre><code>./build/tools/device/mkvendor.sh <span class="comment">[vendorname]</span> <span class="comment">[codename]</span> <span class="comment">[boot.img|recovery.img]</span>
</code></pre><p>If it returns the message “unpackbootimg not found. Is your android build environment set up and have the host tools been built?” please be sure that you run the following command during setting up the developer environment:</p>
<pre><code><span class="variable">$ </span>make -j4 otatools
</code></pre><p>$ export PATH=$PATH:[source path]/out/host/linux-x86/bin</p>
<pre><code>$ ./build/tools/device/mkvendor<span class="class">.sh</span> lenovo s2 ../lenove_s2/mmcblk0p8_boot<span class="class">.img</span> 
Arguments: lenovo s2 ../lenove_s2/mmcblk0p8_boot<span class="class">.img</span>
Output will be <span class="keyword">in</span> /data/Android/Cyanogenmod/device/lenovo/s2
<span class="number">737</span> blocks
Creating <span class="attribute">initial</span> git repository.
/data/Android/Cyanogenmod/device/lenovo/s2 /data/Android/Cyanogenmod
Initialized empty Git repository <span class="keyword">in</span> /data/Android/Cyanogenmod/device/lenovo/s2/.git/
[master (root-commit) <span class="number">89</span>d920e] mkvendor<span class="class">.sh</span>: Initial commit of s2
 <span class="number">8</span> files changed, <span class="number">96</span> <span class="function"><span class="title">insertions</span><span class="params">(+)</span></span>
 create mode <span class="number">100644</span> AndroidBoard<span class="class">.mk</span>
 create mode <span class="number">100644</span> AndroidProducts<span class="class">.mk</span>
 create mode <span class="number">100644</span> BoardConfig<span class="class">.mk</span>
 create mode <span class="number">100644</span> cm<span class="class">.mk</span>
 create mode <span class="number">100644</span> device_s2<span class="class">.mk</span>
 create mode <span class="number">100644</span> kernel
 create mode <span class="number">100644</span> recovery<span class="class">.fstab</span>
 create mode <span class="number">100644</span> system<span class="class">.prop</span>
/data/Android/Cyanogenmod
Done!
Use the following command to set up your build environment:
  lunch cm_s2-eng
And use the follwowing command to build <span class="tag">a</span> recovery:
  . build/tools/device/makerecoveries<span class="class">.sh</span> cm_s2-eng
</code></pre><p>此时在device/[vendorname]/[codename]/目录下会生成 AndroidBoard.mk, AndroidProducts.mk, BoardConfig.mk, cm.mk, device_[codename].mk, kernel , recovery.fstab等文件</p>
<pre><code>ls device/lenovo/s2/
AndroidBoard<span class="class">.mk</span>  AndroidProducts<span class="class">.mk</span>  BoardConfig<span class="class">.mk</span>  cm<span class="class">.mk</span>  device_s2<span class="class">.mk</span>  kernel  recovery<span class="class">.fstab</span>  system.prop
</code></pre><h3 id="客制化生成的文件">客制化生成的文件</h3><p>为了能使用生成的recovery.img正常工作，我们需要到device/[vendorname]/[codename]/下对生生的文件根据手机做相应的修改;</p>
<p>Setup build environment:</p>
<pre><code><span class="tag">lunch</span> <span class="tag">cm_</span><span class="attr_selector">[codename]</span><span class="tag">-eng</span>
<span class="tag">lunch</span> <span class="tag">cm_s2-eng</span>
</code></pre><p>build recovery image:</p>
<pre><code>. build/tools/device/makerecoveries<span class="class">.sh</span> cm_[codename]-eng
. build/tools/device/makerecoveries<span class="class">.sh</span> cm_s2-eng
</code></pre><p>这样就完成了recovery.img的编译，但是发现用了两部手机通过此步骤做出的recovery.img刷进去后手机无法启动该recovery。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/09/29/porting-cyanogenmod/" data-id="cih0e9avr00063xhjdzhmnynn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>





  
    <article id="post-build-cm-11-source-code" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/24/build-cm-11-source-code/" class="article-date">
  <time datetime="2015-08-24T05:13:31.000Z" itemprop="datePublished">2015-08-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/24/build-cm-11-source-code/">build cm-11 source code</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="编译环境准备">编译环境准备</h2><h3 id="编译环境">编译环境</h3><p>uname -a<br>Linux wonfee-ThinkPad-T540p 3.16.7-ckt5my-very-own-kernel #1 SMP Fri Feb 27 23:04:29 CST 2015 x86_64 x86_64 x86_64 GNU/Linux</p>
<p>cat /etc/issue<br>Ubuntu 14.04.2 LTS \n \l</p>
<p>java -version<br>java version “1.6.0_30”<br>Java(TM) SE Runtime Environment (build 1.6.0_30-b12)<br>Java HotSpot(TM) 64-Bit Server VM (build 20.5-b03, mixed mode)</p>
<h3 id="安装其他必要的库">安装其他必要的库</h3><p>该部分可参考android源码官方编译文档，若已成功编译过android源码，则该部分的库应该都已经安装。<br>sudo apt-get install bison build-essential curl flex \<br>g++-multilib gcc-multilib git-core gnupg gperf \<br>lib32ncurses5-dev lib32readline-gplv2-dev lib32z1-dev \<br>libesd0-dev libncurses5-dev libsdl1.2-dev \<br>libwxgtk2.8-dev libxml2 libxml2-utils lzop \<br>openjdk-6-jdk openjdk-6-jre pngcrush schedtool \<br>squashfs-tools xsltproc zip zlib1g-dev</p>
<h2 id="下载cm源码">下载cm源码</h2><p>参考： <a href="http://wonfee.github.io/2015/08/22/CyanogenMod-Source-Code-Download/">CyanogenMod Source Code Download</a></p>
<p>下载好cm-11源码后，如果要编译此时还需要下载其所支持机型相关的device、kernel等代码, 这里以官方所支持的nexus7机型作为测试。</p>
<p>从cm官方的github页面[cm-github][2]搜索grouper可以看到还需要下载device和kernel部分，分别为android_device_asus_grouper、android_kernel_asus_grouper，<br>mkdir -p device/asus/ &amp;&amp; cd device/asus<br>git clone <a href="https://github.com/CyanogenMod/android_kernel_asus_grouper.git" target="_blank" rel="external">https://github.com/CyanogenMod/android_kernel_asus_grouper.git</a> grouper<br>cd ../../<br>mkdir -p kernel/asus &amp;&amp; cd kernel/asus/<br>git clone <a href="https://github.com/CyanogenMod/android_device_asus_grouper.git" target="_blank" rel="external">https://github.com/CyanogenMod/android_device_asus_grouper.git</a> grouper</p>
<h2 id="编译CM-11_源码">编译CM-11 源码</h2><p>source build/envsetup.sh </p>
<pre><code>including device/generic/armv7-a-neon/vendorsetup<span class="class">.sh</span>
including device/generic/goldfish/vendorsetup<span class="class">.sh</span>
including device/generic/mips/vendorsetup<span class="class">.sh</span>
including device/generic/x86/vendorsetup<span class="class">.sh</span>
including vendor/cm/vendorsetup<span class="class">.sh</span>
including sdk/bash_completion/adb<span class="class">.bash</span>
including vendor/cm/bash_completion/git<span class="class">.bash</span>
including vendor/cm/bash_completion/repo.bash
</code></pre><p>breakfast grouper</p>
<p>Download the necessary prebuilts from cyanogenmod by running</p>
<pre><code><span class="keyword">cd</span> verdor/<span class="keyword">cm</span>/
</code></pre><p> . get-prebuilts </p>
<pre><code>  % <span class="constant">Total </span>   % <span class="constant">Received </span>% <span class="constant">Xferd </span> <span class="constant">Average Speed </span>  <span class="constant">Time </span>   <span class="constant">Time </span>    <span class="constant">Time </span> <span class="constant">Current</span>
                                 <span class="constant">Dload </span> <span class="constant">Upload </span>  <span class="constant">Total </span>  <span class="constant">Spent </span>   <span class="constant">Left </span> <span class="constant">Speed</span>
<span class="number">100</span>   <span class="number">178</span>  <span class="number">100</span>   <span class="number">178</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">229</span>      <span class="number">0</span> --<span class="symbol">:--</span><span class="symbol">:--</span> --<span class="symbol">:--</span><span class="symbol">:--</span> --<span class="symbol">:--</span><span class="symbol">:--</span>   <span class="number">229</span>
<span class="number">100</span>  <span class="number">551</span>k  <span class="number">100</span>  <span class="number">551</span>k    <span class="number">0</span>     <span class="number">0</span>   <span class="number">265</span>k      <span class="number">0</span>  <span class="number">0</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">02</span>  <span class="number">0</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">02</span> --<span class="symbol">:--</span><span class="symbol">:--</span> <span class="number">1531</span>k
<span class="constant">Archive:</span>  ./proprietary/<span class="constant">Term.</span>apk
  <span class="symbol">inflating:</span> ./proprietary/lib/armeabi/libjackpal-androidterm5.so  
  <span class="symbol">inflating:</span> ./proprietary/lib/mips/libjackpal-androidterm5.so  
  <span class="symbol">inflating:</span> ./proprietary/lib/x86/libjackpal-androidterm5.so  
  <span class="symbol">inflating:</span> ./proprietary/lib/armeabi/libjackpal-termexec2.so  
  <span class="symbol">inflating:</span> ./proprietary/lib/mips/libjackpal-termexec2.so  
  <span class="symbol">inflating:</span> ./proprietary/lib/x86/libjackpal-termexec2.so
</code></pre><p>croot</p>
<p>Building the ROM</p>
<p>brunch grouper  </p>
<pre><code><span class="string">running:</span>  java -Xmx2048m -jar <span class="regexp">/data/</span>Android<span class="regexp">/Cyanogenmod/</span>out<span class="regexp">/host/</span>linux-x86<span class="regexp">/framework/</span>signapk.jar -w build<span class="regexp">/target/</span>product<span class="regexp">/security/</span>testkey.x509.pem build<span class="regexp">/target/</span>product<span class="regexp">/security/</span>testkey.pk8 <span class="regexp">/tmp/</span>tmpFcHrQD <span class="regexp">/data/</span>Android<span class="regexp">/Cyanogenmod/</span>out<span class="regexp">/target/</span>product<span class="regexp">/grouper/</span>cm_grouper-ota-<span class="number">387</span>c0dd2e4.zip
done.
Package <span class="string">Complete:</span> <span class="regexp">/data/</span>Android<span class="regexp">/Cyanogenmod/</span>out<span class="regexp">/target/</span>product<span class="regexp">/grouper/</span>cm-<span class="number">11</span>-<span class="number">20150824</span>-UNOFFICIAL-grouper.zip
</code></pre><p>注意事项：</p>
<ol>
<li>若编译环境有配置NDK_ROOT环境变量，则编译前需要取消该环境变量unset NDK_ROOT, 否则编译会直接如下报错;<br>build/core/base_rules.mk:134: <em>*</em> external/webrtc/src/system_wrappers/source: MODULE.TARGET.STATIC_LIBRARIES.libwebrtc_system_wrappers already defined by external/webrtc/src/system_wrappers/source.  Stop.<br>build error!</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/08/24/build-cm-11-source-code/" data-id="cih0e9aw7000p3xhjzhnj78af" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CyanogenMod-android-build/">CyanogenMod android build</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-CyanogenMod-Source-Code-Download" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/22/CyanogenMod-Source-Code-Download/" class="article-date">
  <time datetime="2015-08-22T01:02:33.000Z" itemprop="datePublished">2015-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/22/CyanogenMod-Source-Code-Download/">CyanogenMod Source Code Download</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="env_ubuntu_14-04_64">env ubuntu 14.04 64</h2><p>mkdir CyanogenMod &amp;&amp; cd CyanogenMod<br>下载repo<br>curl <a href="http://php.webtutor.pl/en/wp-content/uploads/2011/09/repo" target="_blank" rel="external">http://php.webtutor.pl/en/wp-content/uploads/2011/09/repo</a> &gt; ./repo<br>chmod 755 ./repo<br>初始化：<br>./repo init -u git://github.com/CyanogenMod/android.git -b cm-11.0<br>同步源码：<br>./repo sync -j4</p>
<ul>
<li>[new tag]         android-wear-5.1.0_r1 -&gt; android-wear-5.1.0_r1</li>
<li>[new tag]         android-wear-5.1.1_r1 -&gt; android-wear-5.1.1_r1<br>Fetching projects: 100% (477/477), done.<br>Checking out files: 100% (44267/44267), done. files:  22% (10167/44267)<br>Checking out files: 100% (6686/6686), done.out files:  24% (1636/6686)<br>Checking out files: 100% (9389/9389), done.out files:  32% (3007/9389)<br>Checking out files: 100% (50822/50822), done.t files:   3% (1619/50822)<br>Checking out files: 100% (10083/10083), done.<br>Checking out files: 100% (4307/4307), done.out files:   2% (110/4307)<br>Checking out files: 100% (4082/4082), done.out files:  24% (987/4082)<br>Checking out files: 100% (3494/3494), done.out files:  10% (376/3494)<br>Checking out files: 100% (7954/7954), done.<br>Checking out files: 100% (4098/4098), done. out files:  20% (826/4098)<br>Checking out files: 100% (11685/11685), done.ut files:  19% (2317/11685)<br>Checking out files: 100% (4093/4093), done. out files:  29% (1193/4093)<br>Checking out files: 100% (1654/1654), done. out files:  30% (510/1654)<br>Checking out files: 100% (23588/23588), done.ut files:   0% (149/23588)<br>Checking out files: 100% (4629/4629), done. out files:  34% (1592/4629)<br>Checking out files: 100% (8597/8597), done.<br>Checking out files: 100% (1765/1765), done. out files:   0% (12/1765)<br>Checking out files: 100% (575/575), done.ng out files:  21% (123/575)<br>Checking out files: 100% (431/431), done.ng out files:  10% (47/431)<br>Checking out files: 100% (181/181), done.ng out files:  48% (87/181)<br>Checking out files: 100% (2407/2407), done. out files:  33% (795/2407)<br>Checking out files: 100% (2482/2482), done.<br>Checking out files: 100% (177/177), done.ng out files:  10% (19/177)<br>Checking out files: 100% (182/182), done.<br>Checking out files: 100% (50299/50299), done.ut files:  16% (8475/50299)<br>Checking out files: 100% (4864/4864), done.<br>Checking out files: 100% (182/182), done.ng out files:   7% (14/182)<br>Checking out files: 100% (1256/1256), done.<br>Checking out files: 100% (53361/53361), done.ut files:   2% (1108/53361)<br>Checking out files: 100% (126/126), done.<br><strong>Syncing work tree: 100% (477/477), done.</strong> </li>
</ul>
<p>看到最后的 “Syncing work tree: 100% (477/477), done.” 代表代码同步完成。 由于同步代码会比较耗时，且网络不好断开时，没有同步完成的代码会以 tmp<em>pack_xxx 的形式保存在.repo/projects/仓库名/objects/pack/tmp_pack_XXX 目录下面，再次同步时会从头开始，若多次断开就会在该目录下存在多个tmp_pack_XXX的临时文件并占用大量空间，该文件会在代码同步完成后被删除，也可以手动删除 find ./ -name tmp_pack</em>* -exec rm -rf {} \;</p>
<p>同步代码时为了防止断网导致同步中断可以用一个shell脚本来循环执行repo sync的操作直到成功：</p>
<pre><code>./repo <span class="keyword">sync</span> -j16
<span class="keyword">while</span> [ $? != <span class="number">0</span> ]
<span class="keyword">do</span>
    ### maybe disconnect, <span class="keyword">try</span> again
    <span class="keyword">sleep</span> <span class="number">1</span>
    ./repo <span class="keyword">sync</span> -j16
done
</code></pre><p>下面是代码同步完成后的目录结构：</p>
<pre><code>.
├── abi
├── <span class="keyword">android
</span>├── art
├── <span class="keyword">bionic
</span>├── <span class="keyword">bootable
</span>├── <span class="keyword">build
</span>├── cts
├── dalvik
├── developers
├── development
├── device
├── docs
├── external
├── frameworks
├── hardware
├── kernel
├── libcore
├── libnativehelper
├── Makefile
├── ndk
├── packages
├── pdk
├── prebuilt
├── prebuilts
├── repo
├── sdk
├── sync.sh
├── system
├── tools
└── vendor
</code></pre><p>来看下整个仓库的大小：</p>
<pre><code><span class="number">45</span>M    ./developers
<span class="number">118</span>M./development
<span class="number">46</span>M    ./libcore
<span class="number">12</span>M    ./system
<span class="number">4.2</span>G./prebuilts
<span class="number">1.2</span>G./frameworks
<span class="number">11</span>M    ./build
<span class="number">8.0</span><span class="keyword">K</span>./kernel
<span class="number">33</span>M    ./sdk
<span class="number">13</span>M    ./art
<span class="number">88</span>M    ./hardware
<span class="number">3.2</span>G./external
<span class="number">12</span>M    ./device
<span class="number">424</span>M./cts
<span class="number">42</span>M    ./dalvik
<span class="number">9.1</span>M./docs
<span class="number">12</span>M    ./bootable
<span class="number">19</span>M    ./bionic
<span class="number">971</span>M./tools
<span class="number">18</span>G    ./.repo
<span class="number">120</span><span class="keyword">K</span>./abi
<span class="number">72</span><span class="keyword">K</span>    ./android
<span class="number">196</span><span class="keyword">K</span>./libnativehelper
<span class="number">260</span>M./prebuilt
<span class="number">89</span>M    ./vendor
<span class="number">382</span>M./packages
<span class="number">916</span><span class="keyword">K</span>./pdk
<span class="number">77</span>M    ./ndk
<span class="number">29</span>G.
</code></pre><p>29G，.repo就占了18G，可见仓库的历史记录占用了很大的空间。代码同步完成就可以开始进行编译定制自己的rom了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/08/22/CyanogenMod-Source-Code-Download/" data-id="cih0e9avf00003xhjrzicm0eg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CyanogenMod-Android/">CyanogenMod Android</a></li></ul>

    </footer>
  </div>
  
</article>





  
    <article id="post-Makefile-tutorial" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/22/Makefile-tutorial/" class="article-date">
  <time datetime="2015-08-22T00:33:45.000Z" itemprop="datePublished">2015-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/22/Makefile-tutorial/">Makefile tutorial</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>工作中主要是通过ndk交叉编译生产arm平台的可执行程序及库，但实际调试代码时还是在x86上会更方便一些，因此对于自己编写或者移植过来的代码中没有makefile的就需要自己编写makefile来进行编译。</p>
<h2 id="（一）单目录多文件Makefile编写">（一）单目录多文件Makefile编写</h2><p>目录机构如下：</p>
<p>├── Libusb.c<br>├── Libusb.h<br>├── main.c<br>├── makefile<br>├── Makefile<br>├── mybluetooth.c<br>├── mybluetooth.h<br>├── obex.c<br>├── ObexDef.h<br>├── obex.h<br>├── ObexPack.c<br>└── ObexPack.h</p>
<p>一、 执行gcc分别编译</p>
<pre><code>CFLAGS:= -g #-fshort-wchar

all : main
main : main<span class="class">.o</span> mybluetooth<span class="class">.o</span> Libusb<span class="class">.o</span> obex<span class="class">.o</span> ObexPack<span class="class">.o</span>
    gcc $(CFLAGS) -o main main<span class="class">.o</span> mybluetooth<span class="class">.o</span> Libusb<span class="class">.o</span> obex<span class="class">.o</span> ObexPack<span class="class">.o</span> -lbluetooth `pkg-config --cflags --libs libusb-<span class="number">1.0</span>` -lusb

main<span class="class">.o</span> : main<span class="class">.c</span>
    gcc $(CFLAGS) -c main<span class="class">.c</span>

Libusb<span class="class">.o</span>: Libusb<span class="class">.c</span>
    gcc $(CFLAGS) -c Libusb<span class="class">.c</span> `pkg-config --libs --cflags libusb-<span class="number">1.0</span>` -lusb

mybluetooth<span class="class">.o</span> : mybluetooth<span class="class">.c</span>
    gcc $(CFLAGS) -c mybluetooth<span class="class">.c</span> -lbluetooth

obex<span class="class">.o</span>: obex<span class="class">.c</span>
    gcc $(CFLAGS) -c obex<span class="class">.c</span> 

ObexPack<span class="class">.o</span>: ObexPack<span class="class">.c</span>
    gcc $(CFLAGS) -c ObexPack<span class="class">.c</span>

clean:
    rm -rf *<span class="class">.o</span> main .*.swp
</code></pre><p>二、使用makefile的自动推导功能</p>
<pre><code>CC = gcc
CFLAGS = -g -Wall -I/usr/include/libusb-<span class="number">1.0</span>  -lusb-<span class="number">1.0</span> -lusb -lbluetooth

OBJS= Libusb<span class="class">.o</span>  main<span class="class">.o</span>  mybluetooth<span class="class">.o</span>  obex<span class="class">.o</span>  ObexPack<span class="class">.o</span>

main: $(OBJS)
    $(CC) -o main $(OBJS) $(CFLAGS)

#以下可以不用写
<span class="id">#main</span><span class="class">.o</span>: ObexDef<span class="class">.h</span>
<span class="id">#obex</span><span class="class">.o</span>: obex<span class="class">.h</span>
<span class="id">#ObexPack</span><span class="class">.o</span>: ObexPack<span class="class">.h</span> ObexDef<span class="class">.h</span>
<span class="id">#Libusb</span><span class="class">.o</span>: Libusb<span class="class">.h</span>
<span class="id">#mybluetooth</span><span class="class">.o</span>: mybluetooth<span class="class">.h</span>

<span class="class">.PHONY</span>: clean
clean:
    rm $(OBJS) main
</code></pre><h2 id="（二）多目录多文件makefile编写">（二）多目录多文件makefile编写</h2><p>以下引用自博客园<a href="http://www.cnblogs.com/lidabo/p/4521117.html" target="_blank" rel="external">多目录下多文件 makefile编写</a><br>在编写多目录的makefile时，一般会用到如下的几个函数和变量；<br>函数：</p>
<pre><code>wildcard 这是扩展通配符函数，功能是展开成一列所有符合由其参数描述的文 件名，文件间以空格间隔；比如：罗列出src下的所有.c文件：<span class="variable">$(</span>wildcard <span class="variable">${</span><span class="constant">SRC}</span>/*.c)

patsubst 这是匹配替换函数， patsubst （ 需要匹配的文件样式，匹配替换成什么文件，需要匹配的源文件）函数。比如：用src下的*.c替换成对应的 *.o文件存放到obj中：<span class="variable">$(</span>patsubst  %.c, <span class="variable">${</span><span class="constant">OBJ}</span>/%.o, <span class="variable">$(</span>notdir <span class="variable">$(</span><span class="constant">SOURCE)</span>))

notdir 这是去除路径函数，在上面patsubst函数中已经使用过，去除<span class="constant">SOURCE中</span>文件的所有目录，只留下文件名；
</code></pre><p>变量：</p>
<pre><code><span class="variable">$@</span><span class="symbol">:</span>表示目标文件；一般是在规则中这么用：gcc  -o <span class="variable">$@</span>  <span class="variable">$(</span>object)；

<span class="variable">$^</span><span class="symbol">:</span>表示所有依赖文件；一般是在规则中这么用：gcc -o <span class="variable">$@</span>  <span class="variable">$^</span>  ；用所有依赖文件链接成目的文件；

<span class="variable">$&lt;</span><span class="symbol">:</span>表示第一个依赖文件；在规则中使用：gcc -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span> ；其实这个时候就是每个依赖文件生成一个目的文件；
</code></pre><p>makefile模板:</p>
<pre><code><span class="comment">#把所有的目录做成变量，方便修改和移植   </span>
 <span class="constant">BIN</span> = ./bin  
 <span class="constant">SRC</span> = ./src  
 <span class="constant">INC</span> = ./<span class="keyword">include</span>  
 <span class="constant">OBJ</span> = ./obj  

<span class="comment">#提前所有源文件(即：*.c文件)和所有中间文件(即：*.o)  </span>
 <span class="constant">SOURCE</span> = <span class="variable">$(</span>wildcard <span class="variable">${</span><span class="constant">SRC</span>}/*.c)  
 <span class="constant">OBJECT</span> = <span class="variable">$(</span>patsubst %.c,<span class="variable">${</span><span class="constant">OBJ</span>}/%.o,<span class="variable">$(</span>notdir <span class="variable">${</span><span class="constant">SOURCE</span>}))  

<span class="comment">#设置最后目标文件  </span>
 <span class="constant">TARGET</span> = main  
 <span class="constant">BIN_TARGET</span> = <span class="variable">${</span><span class="constant">BIN</span>}/<span class="variable">${</span><span class="constant">TARGET</span>}  

 <span class="constant">CC</span> = gcc   
 <span class="constant">CFLAGS</span> = -g -<span class="constant">Wall</span> -<span class="constant">I</span><span class="variable">${</span><span class="constant">INC</span>}   

<span class="comment">#用所有中间文件生成目的文件，规则中可以用 $^替换掉 ${OBJECT}  </span>
 <span class="variable">${</span><span class="constant">BIN_TARGET</span>}<span class="symbol">:</span><span class="variable">${</span><span class="constant">OBJECT</span>}  
     <span class="variable">$(</span><span class="constant">CC</span>) -o <span class="variable">$@</span> <span class="variable">${</span><span class="constant">OBJECT</span>}  

<span class="comment">#生成各个中间文件  </span>
 <span class="variable">${</span><span class="constant">OBJ</span>}/%.<span class="symbol">o:</span><span class="variable">${</span><span class="constant">SRC</span>}/%.c   
     <span class="variable">$(</span><span class="constant">CC</span>) <span class="variable">$(</span><span class="constant">CFLAGS</span>) -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span>  

 .<span class="constant">PHONY</span><span class="symbol">:clean</span>  
 <span class="symbol">clean:</span>  
     find <span class="variable">$(</span><span class="constant">OBJ</span>) -name *.o -exec rm -rf {} \; <span class="comment">#这个是find命令，不懂的可以查下资料  </span>
     rm -rf <span class="variable">$(</span><span class="constant">BIN_TARGET</span>)  
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://wonfee.github.io/2015/08/22/Makefile-tutorial/" data-id="cih0e9awg00153xhjhgguy7er" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/makefile-linux/">makefile linux</a></li></ul>

    </footer>
  </div>
  
</article>





  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CyanogenMod-Android/">CyanogenMod Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CyanogenMod-android-build/">CyanogenMod android build</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitolite/">gitolite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k3v2oem1-kernel/">k3v2oem1 kernel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libusb-win32/">libusb-win32</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile-linux/">makefile linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mingw-cross-compile/">mingw cross-compile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/personal-blog/">personal blog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse-tools/">reverse tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scm-git-svn/">scm, git, svn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell-cmds/">shell cmds</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/syscall/">syscall</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win8-administrator/">win8 administrator</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CyanogenMod-Android/" style="font-size: 10px;">CyanogenMod Android</a> <a href="/tags/CyanogenMod-android-build/" style="font-size: 10px;">CyanogenMod android build</a> <a href="/tags/gitolite/" style="font-size: 10px;">gitolite</a> <a href="/tags/hexo/" style="font-size: 20px;">hexo</a> <a href="/tags/k3v2oem1-kernel/" style="font-size: 10px;">k3v2oem1 kernel</a> <a href="/tags/libusb-win32/" style="font-size: 10px;">libusb-win32</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/makefile-linux/" style="font-size: 10px;">makefile linux</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mingw-cross-compile/" style="font-size: 10px;">mingw cross-compile</a> <a href="/tags/personal-blog/" style="font-size: 10px;">personal blog</a> <a href="/tags/reverse-tools/" style="font-size: 10px;">reverse tools</a> <a href="/tags/scm-git-svn/" style="font-size: 10px;">scm, git, svn</a> <a href="/tags/shell-cmds/" style="font-size: 10px;">shell cmds</a> <a href="/tags/syscall/" style="font-size: 10px;">syscall</a> <a href="/tags/win8-administrator/" style="font-size: 10px;">win8 administrator</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/11/15/add-system-call-to-linux/">add system call to linux</a>
          </li>
        
          <li>
            <a href="/2015/11/12/compile-binary-fow-windows-on-linux-with-mingw/">compile binary fow windows on linux with mingw</a>
          </li>
        
          <li>
            <a href="/2015/11/03/add-libusb-win32-to-vc-project/">add libusb-win32 to vc project</a>
          </li>
        
          <li>
            <a href="/2015/10/19/huawei-k3v2oem1-kernel-compile/">huawei k3v2oem1 kernel compile</a>
          </li>
        
          <li>
            <a href="/2015/10/15/android-reverse-tools/">android reverse tools</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget tag">
<p class="asidetitle">联系方式</p>
<ul class="entry">
<li>QQ：845016952</li>
<li>email：dasifly@gmail.com</li>
</ul>
</div>

  
    <div class="widget tag">
    <h3 class="title">友情链接</h3>
    <ul class="entry">
    <li><a href="http://blog.163.com/dasifly@126/manage/#m=0&t=0" title="网易博客">网易博客</a></li>
    </ul>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Wonfee<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>